# Device Mapper Proxy (dmp) Kernel Module

–í –∑–∞–¥–∞–Ω–∏–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å —è–¥—Ä–∞ –ø–æ–¥ –û–° Linux, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –±–ª–æ—á–Ω—ã–µ —É—Å—Ç—Ä–π–æ—Å—Ç–≤–∞ –ø–æ–≤–µ—Ä—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –Ω–∞ –±–∞–∑–µ device mapper –∏ —Å–ª–µ–¥–∏—Ç –∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.

## üìå –û–ø–∏—Å–∞–Ω–∏–µ

–ú–æ–¥—É–ª—å —è–¥—Ä–∞ Linux "dmp" —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π —Ç–∞—Ä–≥–µ—Ç –¥–ª—è Device Mapper. –û–Ω —Å–æ–∑–¥–∞—ë—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –±–ª–æ—á–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—â–µ–µ I/O-–∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –±–∞–∑–æ–≤–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ "sysfs".


–ú–æ–¥—É–ª—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞:

- Debian 12.11

---

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/keyfda/test-task-module.git
cd test-task-module
```

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ü–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ —è–¥—Ä–∞ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–±–æ—Ä–∫–∏.

### Debian

```bash
sudo apt update
sudo apt install build-essential linux-headers-$(uname -r)
```


–ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∫–∏
```bash
make
```
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—è–≤–∏–ª—Å—è .ko —Ñ–∞–π–ª –º–æ–¥—É–ª—è.

## –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è


```bash
sudo insmod dmp.ko
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–æ–¥—É–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω:
```bash
lsmod | grep dmp
```

–ê —Ç–∞–∫–∂–µ dmesg
```bash
sudo dmesg | tail
```


### –£—Å—Ç–Ω–æ–≤–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ—á–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
```bash
sudo dmsetup create zero1 --table "0 $size zero"
```
Note: $size - –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–æ—Å—å
```bash
ls -al /dev/mapper/
```


–î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å proxy-—É—Å—Ç—Ä–π–æ—Å—Ç–≤–æ

```bash
sudo dmsetup create dmp1 --table "0 $size dmp /dev/mapper/zero1"
```

Note: $size - —Ä–∞–∑–º–µ—Ä —É—Å—Ç—Ä–π–æ—Å—Ç–≤–∞ /dev mapper/zero1.

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–í–≤–æ–¥
```bash
sudo dd if=/dev/random of=/dev/mapper/dmp1 bs=4k count=1
```
–í—ã–≤–æ–¥
```bash
sudo dd of=/dev/null if=/dev/mapper/dmp1 bs=4k count=1
```


## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 
```bash
cat /sys/kernel/dmp
```
–í —ç—Ç–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è 6 —Ñ–∞–π–ª–æ–≤:
avg_size - —Å—Ä–µ–¥–Ω–π–∏ —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
avg_write_size - —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞ –∑–∞–ø–∏—Å–∏
avg_read_size - —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞ —á—Ç–µ–Ω–∏—è
write_reqs - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏
read-reqs - –∫–æ–ª–∏—á–µ—Å–≤—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è
total_reqs - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π


